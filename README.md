


## Êñá‰ª∂ËØ¥Êòé

ËøôÊòØ‰∏Ä‰∏™Â∞ÜMarkdownÊñá‰ª∂ËΩ¨Êç¢‰∏∫Microsoft Word (.docx)ÊñáÊ°£ÁöÑÂ∑•ÂÖ∑ÔºåÂÖ∑ÊúâÁâπÊÆäÁöÑÂõæË°®Ê∏≤ÊüìÊîØÊåÅ„ÄÇËØ•Â∑•ÂÖ∑ÂèØ‰ª•ËØÜÂà´Âπ∂Ê∏≤ÊüìÂµåÂÖ•Âú®Markdown‰∏≠ÁöÑÂêÑÁßçÂõæË°®ÔºàMermaid„ÄÅVega„ÄÅVega-LiteÔºâÔºåÂπ∂Â∞ÜÂÆÉ‰ª¨‰Ωú‰∏∫È´òË¥®ÈáèÂõæÂÉèÂµåÂÖ•Âà∞ÁîüÊàêÁöÑWordÊñáÊ°£‰∏≠„ÄÇÊ≠§Â§ñÔºåÂÆÉËøòÊîØÊåÅËá™ÂÆö‰πâÊñáÊú¨Ê†ºÂºèÂåñÔºåÂ¶ÇÂ∞ÜUnicodeÈ¢úËâ≤ÂõæÊ†áËΩ¨Êç¢‰∏∫ÂΩ©Ëâ≤ÊñáÊú¨„ÄÇ

‰∏ªË¶ÅÊñá‰ª∂Ôºö
- `tools/md2docx.py`: Ê†∏ÂøÉËΩ¨Êç¢Â∑•ÂÖ∑ÁöÑÂÆûÁé∞
- `tools/md2docx.md`: LangChainÂáΩÊï∞Ë∞ÉÁî®È£éÊ†ºÁöÑÂ∑•ÂÖ∑ÊñáÊ°£ÔºåËØ¶ÁªÜËØ¥Êòé‰∫ÜÂ∑•ÂÖ∑ÁöÑ‰ΩøÁî®ÊñπÊ≥ïÂíåÂèÇÊï∞
- `parser.py`: ÂëΩ‰ª§Ë°åÊé•Âè£
- `test.py`: ÊâπÈáèÂ§ÑÁêÜÊµãËØïËÑöÊú¨
- `test_data/`: ÊµãËØïÁî®ÁöÑMarkdownÊñá‰ª∂
- `results/`: ÁîüÊàêÁöÑWordÊñáÊ°£ËæìÂá∫ÁõÆÂΩï

## ÂäüËÉΩÁâπÁÇπ

* Â∞ÜMarkdownËΩ¨Êç¢‰∏∫DOCXÊ†ºÂºè
* Ê∏≤ÊüìMermaid„ÄÅVegaÂíåVega-LiteÂõæË°®‰∏∫PNGÂõæÂÉèÂπ∂ÂµåÂÖ•Âà∞ÊñáÊ°£‰∏≠
* Â∞ÜÁâπÂÆöÁöÑUnicodeÈ¢úËâ≤ÂõæÊ†áÔºàÂ¶Çüü¢„ÄÅüü°„ÄÅüî¥„ÄÅ‚ö™ÔºâËΩ¨Êç¢‰∏∫WordÊñáÊ°£‰∏≠ÁöÑÂΩ©Ëâ≤ÂúÜÂúàË°®Á§∫
* ‰∏∫Ë°®Ê†ºÂ∫îÁî®ÂÆåÊï¥ÁöÑÁΩëÊ†ºËæπÊ°Ü
* ÁßªÈô§PandocÁîüÊàêÁöÑ‰π¶Á≠æÔºàÂèØÈÄâÔºâ
* Êèê‰æõÂëΩ‰ª§Ë°åÊé•Âè£Ôºå‰æø‰∫éÈõÜÊàêÂà∞Â∑•‰ΩúÊµÅÁ®ã‰∏≠

## È£éÈô©ÂíåÊ≥®ÊÑè‰∫ãÈ°π

### MermaidÂõæË°®Ê∏≤Êüì

1. **ÈúÄË¶ÅËÅîÁΩë**: MermaidÂ∫ì‰ΩøÁî®Âú®Á∫øAPIÔºàhttps://mermaid.inkÔºâÊù•Ê∏≤ÊüìÂõæË°®„ÄÇÂ¶ÇÊûúÊ≤°Êúâ‰∫íËÅîÁΩëËøûÊé•ÔºåÂõæË°®Ê∏≤ÊüìÂ∞ÜÂ§±Ë¥•„ÄÇ

2. **API‰æùËµñ**: ‰æùËµñÁ¨¨‰∏âÊñπÊúçÂä°Ôºàmermaid.inkÔºâÂèØËÉΩÂ∏¶Êù•‰ª•‰∏ãÈ£éÈô©Ôºö
   - ÊúçÂä°ÂèØËÉΩ‰∏çÁ®≥ÂÆöÊàñÂèòÊõ¥
   - ÂèØËÉΩÊúâËØ∑Ê±ÇÈôêÂà∂
   - ÂõæË°®ÂÜÖÂÆπ‰ºöË¢´ÂèëÈÄÅÂà∞Á¨¨‰∏âÊñπÊúçÂä°Âô®

3. **Graphviz‰æùËµñ**: Êüê‰∫õÂ§çÊùÇÁöÑMermaidÂõæË°®ÔºàÂ¶Ç`graph TD`Á±ªÂûãÔºâÂèØËÉΩÈúÄË¶ÅÂÆâË£ÖGraphvizÊâçËÉΩÊ≠£Á°ÆÊ∏≤Êüì„ÄÇ

### IPythonË≠¶Âëä

1. **Ë≠¶Âëä‰ø°ÊÅØ**: ËøêË°åÊó∂ÂèØËÉΩ‰ºöÁúãÂà∞‰ª•‰∏ãË≠¶ÂëäÔºö
   ```
   Warning: IPython is not installed. Mermaidjs magic function is not available.
   ```

2. **ÂéüÂõ†**: Ëøô‰∏™Ë≠¶ÂëäÊù•Ëá™MermaidÂ∫ìÔºåÂΩìÂÆÉÂ∞ùËØïÂØºÂÖ•IPython‰ΩÜÊú™ÂÆâË£ÖÊó∂ÊòæÁ§∫„ÄÇËôΩÁÑ∂Â∑≤Âú®requirements.txt‰∏≠Ê∑ªÂä†‰∫ÜIPython‰æùËµñÔºå‰ΩÜÂÆûÈôÖ‰∏äÊú¨Â∑•ÂÖ∑Âπ∂‰∏ç‰ΩøÁî®IPythonÁöÑÈ≠îÊ≥ïÂáΩÊï∞ÂäüËÉΩ„ÄÇ

3. **Ëß£ÂÜ≥ÊñπÊ°à**: 
   - ÂèØ‰ª•ÂøΩÁï•Ê≠§Ë≠¶ÂëäÔºåÂÆÉ‰∏çÂΩ±ÂìçÂ∑•ÂÖ∑ÁöÑ‰∏ªË¶ÅÂäüËÉΩ
   - Â∑≤Âú®requirements.txt‰∏≠Ê∑ªÂä†‰∫Üipython>=8.0.0ÔºåÂÆâË£Ö‰æùËµñÂêéË≠¶ÂëäÂ∞ÜÊ∂àÂ§±

## ÁéØÂ¢ÉË¶ÅÊ±Ç

* **Python 3.x**
* **Pandoc**: Á°Æ‰øùPandocÂ∑≤ÂÆâË£ÖÂπ∂ÂèØÂú®Á≥ªÁªüPATH‰∏≠ËÆøÈóÆ„ÄÇÂèØ‰ªé[pandoc.org](https://pandoc.org/installing.html)‰∏ãËΩΩ„ÄÇ
* **uv**: Êú¨È°πÁõÆ‰ΩøÁî®`uv`ËøõË°åPythonÁéØÂ¢ÉÂíåÂåÖÁÆ°ÁêÜ„ÄÇÊåâÁÖß[uv.astral.sh](https://uv.astral.sh/introduction/)ÁöÑËØ¥ÊòéÂÆâË£Ö`uv`„ÄÇ
* **Graphviz** (ÂèØÈÄâ): Â¶ÇÊûúËÆ°Âàí‰ΩøÁî®Â§çÊùÇÁöÑMermaidÂõæË°®ÔºåÂèØËÉΩÈúÄË¶ÅÂÆâË£ÖGraphviz„ÄÇ

## ‰ΩøÁî®uvÂÆâË£ÖÂíåÈÉ®ÁΩ≤ÁéØÂ¢É

### ÂÆâË£Öuv

#### Windows
```powershell
# ‰ΩøÁî®PowerShellÂÆâË£Ö
irm https://astral.sh/uv/install.ps1 | iex
```

#### macOS/Linux
```bash
# ‰ΩøÁî®curlÂÆâË£Ö
curl -fsSL https://astral.sh/uv/install.sh | sh
```

### ÂàõÂª∫ÂíåÊøÄÊ¥ªËôöÊãüÁéØÂ¢É

```bash
# ÂàõÂª∫Âêç‰∏∫'noahenv'ÁöÑËôöÊãüÁéØÂ¢É
uv venv noahenv

# Âú®Linux/macOS‰∏äÊøÄÊ¥ª
source noahenv/bin/activate

# Âú®Windows‰∏äÊøÄÊ¥ª(Command Prompt)
noahenv\Scripts\activate

```

### ÂÆâË£Ö‰æùËµñ

```bash
# ‰ΩøÁî®requirements.txtÂÆâË£ÖÊâÄÊúâ‰æùËµñ
uv pip install -r requirements.txt
```

ÊàñËÄÖÂçïÁã¨ÂÆâË£ÖÔºö
```bash
uv pip install pypandoc altair mermaid python-docx ipython
```

## LangChainÂáΩÊï∞Ë∞ÉÁî®ÈõÜÊàê

Êú¨È°πÁõÆÁöÑ`md2docx`Â∑•ÂÖ∑ÊòØ‰ΩøÁî®LangChainÂáΩÊï∞Ë∞ÉÁî®È£éÊ†ºÁºñÂÜôÁöÑÔºåËøôÊÑèÂë≥ÁùÄÂÆÉÂèØ‰ª•ËΩªÊùæÈõÜÊàêÂà∞Âü∫‰∫éLangChainÁöÑÂ∫îÁî®Á®ãÂ∫è‰∏≠ÔºåÁâπÂà´ÊòØ‰∏éÂ§ßÂûãËØ≠Ë®ÄÊ®°Âûã(LLM)‰∏ÄËµ∑‰ΩøÁî®Êó∂„ÄÇ

### ‰Ωú‰∏∫LangChainÂ∑•ÂÖ∑‰ΩøÁî®(Êú™ÊµãËØï)

```python
from langchain.agents import initialize_agent, AgentType
from langchain.llms import OpenAI
from tools.md2docx import get_markdown_to_word_tool

# Ëé∑ÂèñÂ∑•ÂÖ∑ÂÆû‰æã
markdown_to_word_tool = get_markdown_to_word_tool()

# ÂàõÂª∫LLM
llm = OpenAI(temperature=0)

# ÂàùÂßãÂåñ‰ª£ÁêÜ
agent = initialize_agent(
    [markdown_to_word_tool],
    llm,
    agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

# ‰ΩøÁî®‰ª£ÁêÜÊâßË°å‰ªªÂä°
result = agent.run(
    "Â∞Ü'example.md'ËΩ¨Êç¢‰∏∫WordÊñáÊ°£ÔºåÂπ∂‰øùÂ≠ò‰∏∫'output.docx'"
)
print(result)
```

### Áõ¥Êé•Ë∞ÉÁî®Â∑•ÂÖ∑(ÊµãËØïtest.py)

```python
from tools.md2docx import get_markdown_to_word_tool

# Ëé∑ÂèñÂ∑•ÂÖ∑ÂÆû‰æã
markdown_to_word_tool = get_markdown_to_word_tool()

# ÊñπÊ≥ï1Ôºö‰ΩøÁî®runÊñπÊ≥ïÔºàÊé®ËçêÔºâ
result = markdown_to_word_tool.run({
    "input_path": "path/to/example.md",
    "output_path": "path/to/output.docx",
    "keep_bookmarks": False
})

# ÊñπÊ≥ï2Ôºö‰ΩøÁî®_runÊñπÊ≥ïÔºàÁõ¥Êé•‰º†ÂèÇÔºâ
result = markdown_to_word_tool._run(
    input_path="path/to/example.md",
    output_path="path/to/output.docx",
    keep_bookmarks=False
)

print(result)
```

Êõ¥Â§öËØ¶ÁªÜ‰ø°ÊÅØÂíåÁ§∫‰æãÔºåËØ∑ÂèÇÈòÖ`tools/md2docx.md`ÊñáÊ°£„ÄÇ

## ‰ΩøÁî®ÊñπÊ≥ï

### ÂëΩ‰ª§Ë°åÊé•Âè£

‰ªéÂëΩ‰ª§Ë°åËøêË°åËÑöÊú¨ÔºåÊèê‰æõËæìÂÖ•MarkdownÊñá‰ª∂ÂíåÂèØÈÄâÁöÑËæìÂá∫Êñá‰ª∂Ë∑ØÂæÑ„ÄÇ

```bash
python parser.py -i path/to/your/input.md -o path/to/your/output.docx
```

**ÂèÇÊï∞Ôºö**

* `-i INPUT`, `--input INPUT`: (ÂøÖÈúÄ) ËæìÂÖ•MarkdownÊñá‰ª∂ÁöÑË∑ØÂæÑ„ÄÇ
* `-o OUTPUT`, `--output OUTPUT`: (ÂèØÈÄâ) ËæìÂá∫WordÊñá‰ª∂ÁöÑË∑ØÂæÑ„ÄÇÂ¶ÇÊûúÊú™ÊåáÂÆöÔºåËæìÂá∫Êñá‰ª∂Â∞Ü‰∏éËæìÂÖ•Êñá‰ª∂ÂêåÂêç‰ΩÜÊâ©Â±ïÂêç‰∏∫`.docx`Ôºå‰øùÂ≠òÂú®‰∏éËæìÂÖ•Êñá‰ª∂Áõ∏ÂêåÁöÑÁõÆÂΩï‰∏≠„ÄÇ

**Á§∫‰æãÔºö**

```bash
python parser.py -i test_data/example.md -o results/example_output.docx
```

### ÊâπÈáèÂ§ÑÁêÜ

‰ΩøÁî®`test.py`ËÑöÊú¨ÂèØ‰ª•ÊâπÈáèÂ§ÑÁêÜ`test_data`ÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâMarkdownÊñá‰ª∂Ôºö

```bash
python test.py
```

ËøôÂ∞ÜÂ§ÑÁêÜ`test_data`ÁõÆÂΩï‰∏≠ÁöÑÊâÄÊúâ`.md`Êñá‰ª∂ÔºåÂπ∂Â∞ÜÁªìÊûú‰øùÂ≠òÂà∞`results`ÁõÆÂΩï‰∏≠„ÄÇ

## Â∑•‰ΩúÂéüÁêÜ

1. ËÑöÊú¨‰ΩøÁî®`pypandoc`Â∞ÜËæìÂÖ•ÁöÑMarkdownÊñá‰ª∂Ëß£Êûê‰∏∫ÊäΩË±°ËØ≠Ê≥ïÊ†ë(AST)„ÄÇ
2. ÂÆÉËØÜÂà´`mermaid`„ÄÅ`vega`Âíå`vega-lite`ÁöÑ‰ª£Á†ÅÂùó„ÄÇ
3. Ëøô‰∫õÂõæË°®‰ΩøÁî®`mermaid`Âíå`altair`Â∫ìÂàÜÂà´Ê∏≤Êüì‰∏∫PNGÂõæÂÉè„ÄÇÂõæÂÉè‰øùÂ≠òÂú®‰∏¥Êó∂ÁõÆÂΩï‰∏≠„ÄÇ
4. ASTË¢´ËΩ¨Êç¢ÔºöÂõæË°®‰ª£Á†ÅÂùóË¢´ÊõøÊç¢‰∏∫Ê∏≤ÊüìÂõæÂÉèÁöÑÈìæÊé•ÔºåÁâπÊÆäÁöÑÈ¢úËâ≤ÂõæÊ†áË¢´ËΩ¨Êç¢‰∏∫Ê†∑ÂºèÂåñÊñáÊú¨„ÄÇ
5. `pypandoc`Â∞Ü‰øÆÊîπÂêéÁöÑASTËΩ¨Êç¢‰∏∫`.docx`Êñá‰ª∂„ÄÇ
6. (ÂèØÈÄâ) Â¶ÇÊûúÂÆâË£Ö‰∫Ü`python-docx`ÔºåËÑöÊú¨‰ºöËøõ‰∏ÄÊ≠•Ê†ºÂºèÂåñ.docxÊñá‰ª∂ÔºåÁ°Æ‰øùË°®Ê†ºÊúâÂÆåÊï¥ÁöÑËæπÊ°ÜÂπ∂ÁßªÈô§‰π¶Á≠æ„ÄÇ
7. Ê∏ÖÁêÜÂåÖÂê´Ê∏≤ÊüìÂõæÂÉèÁöÑ‰∏¥Êó∂ÁõÆÂΩï„ÄÇ

## ÊïÖÈöúÊéíÈô§

* **PandocÈîôËØØ**: Á°Æ‰øùPandocÂ∑≤Ê≠£Á°ÆÂÆâË£ÖÂπ∂Âú®PATH‰∏≠„ÄÇÂ∞ùËØïÂú®ÂëΩ‰ª§Ë°å‰∏≠ËøêË°å`pandoc --version`Êù•È™åËØÅ„ÄÇ
* **MermaidÂõæË°®ÈîôËØØ/`mmdc`Êú™ÊâæÂà∞**: Á°Æ‰øù`@mermaid-js/mermaid-cli`Â∑≤ÂÆâË£ÖÔºàÈÄöÂ∏∏ÈÄöËøá`npm`ÔºâÂπ∂‰∏î`mmdc`Âú®PATH‰∏≠„ÄÇ‰∏Ä‰∫õÂ§çÊùÇÁöÑMermaidÂõæË°®ÂèØËÉΩËøòÈúÄË¶ÅGraphviz„ÄÇ
* **IPythonË≠¶Âëä**: Â¶ÇÂâçÊâÄËø∞ÔºåÂèØ‰ª•ÂøΩÁï•ÊàñÈÄöËøáÂÆâË£ÖIPythonËß£ÂÜ≥„ÄÇ
* **ÁΩëÁªúËøûÊé•ÈóÆÈ¢ò**: Á°Æ‰øùÊúâ‰∫íËÅîÁΩëËøûÊé•‰ª•Ê∏≤ÊüìMermaidÂõæË°®„ÄÇ

# ÊñáÊ°£ËΩ¨Êç¢ÊúçÂä°
ËøôÊòØ‰∏Ä‰∏™Âü∫‰∫é Python Âíå FastAPI ÊûÑÂª∫ÁöÑÂº∫Â§ß‰∏îÁÅµÊ¥ªÁöÑÊñáÊ°£ËΩ¨Êç¢ÊúçÂä°„ÄÇ


## System Overview

```mermaid
graph TB
    subgraph "API Layer"
        A[FastAPI Application]
        B[Health Endpoints]
        C[Conversion Endpoints]
        D[Task Endpoints]
    end
    
    subgraph "Service Layer"
        E[ConversionService]
        F[FileService]
        G[TaskService]
        H[BaseService]
    end
    
    subgraph "Data Layer"
        I[TaskRepository]
        J[Database Models]
        K[SQLite Database]
    end
    
    subgraph "External Tools"
        L[md2docx Tool]
        M[File System]
    end
    
    A --> B
    A --> C
    A --> D
    
    C --> E
    D --> G
    
    E --> F
    E --> G
    F --> H
    G --> H
    
    G --> I
    I --> J
    J --> K
    
    E --> L
    F --> M
    
    style A fill:#e1f5fe
    style E fill:#f3e5f5
    style I fill:#e8f5e8
    style L fill:#fff3e0
```

## Service Layer Architecture

```mermaid
classDiagram
    class BaseService {
        +upload_dir: str
        +output_dir: str
        +ensure_directories()
    }
    
    class FileService {
        +save_uploaded_file(file, task_id)
        +get_download_path(task_id)
        +delete_task_files(task_id)
        +cleanup_file(file_path)
        +file_exists(file_path)
        +get_output_file_path(task_id, filename)
    }
    
    class TaskService {
        -task_repository: TaskRepository
        +create_task(task_data)
        +get_task(task_id)
        +update_task_status(task_id, status)
        +update_task_metadata(task_id, metadata)
        +delete_task(task_id)
    }
    
    class ConversionService {
        -file_service: FileService
        -task_service: TaskService
        +create_conversion_task(file, metadata)
        +get_task_status(task_id)
        +download_file(task_id)
        +delete_task(task_id)
        +convert_document_background(task_id)
    }
    
    BaseService <|-- FileService
    BaseService <|-- TaskService
    BaseService <|-- ConversionService
    
    ConversionService --> FileService
    ConversionService --> TaskService
```

## Request Flow Diagram

```mermaid
sequenceDiagram
    participant Client
    participant API as FastAPI
    participant CS as ConversionService
    participant FS as FileService
    participant TS as TaskService
    participant TR as TaskRepository
    participant Tool as md2docx
    
    Client->>API: POST /convert (upload file)
    API->>CS: create_conversion_task()
    
    CS->>FS: save_uploaded_file()
    FS-->>CS: file_path
    
    CS->>TS: create_task()
    TS->>TR: create()
    TR-->>TS: task_id
    TS-->>CS: task_id
    
    CS->>CS: convert_document_background()
    CS->>Tool: md2docx conversion
    Tool-->>CS: converted file
    
    CS->>TS: update_task_status("completed")
    TS->>TR: update()
    
    CS-->>API: task_id
    API-->>Client: {"task_id": "..."}
    
    Client->>API: GET /tasks/{task_id}
    API->>TS: get_task()
    TS->>TR: get_by_id()
    TR-->>TS: task_data
    TS-->>API: task_data
    API-->>Client: task status
    
    Client->>API: GET /download/{task_id}
    API->>CS: download_file()
    CS->>FS: get_download_path()
    FS-->>CS: file_path
    CS-->>API: file_response
    API-->>Client: converted file
```

## File System Structure

```mermaid
graph TD
    A[Noah Project Root]
    A --> B[app/]
    A --> C[tools/]
    A --> D[test_data/]
    A --> E[results/]
    
    B --> F[services/]
    B --> G[events/]
    B --> H[database/]
    B --> I[schema/]
    B --> J[common/]
    
    F --> K[__init__.py]
    F --> L[base_service.py]
    F --> M[file_service.py]
    F --> N[task_service.py]
    F --> O[conversion_service.py]
    F --> P[README.md]
    
    G --> Q[conversion.py]
    G --> R[tasks.py]
    G --> S[health.py]
    
    H --> T[models.py]
    H --> U[repository.py]
    H --> V[connection.py]
    
    C --> W[md2docx.py]
    
    style F fill:#e8f5e8
    style G fill:#e1f5fe
    style H fill:#fff3e0
    style C fill:#f3e5f5
```

## Data Flow

```mermaid
flowchart LR
    A[Upload File] --> B[FileService.save_uploaded_file]
    B --> C[TaskService.create_task]
    C --> D[Background Conversion]
    D --> E[md2docx Tool]
    E --> F[Update Task Status]
    F --> G[File Ready for Download]
    
    H[Client Request] --> I[Get Task Status]
    I --> J[TaskService.get_task]
    J --> K[Return Status]
    
    L[Download Request] --> M[ConversionService.download_file]
    M --> N[FileService.get_download_path]
    N --> O[Return File]
    
    style A fill:#e8f5e8
    style E fill:#f3e5f5
    style G fill:#e1f5fe
```

## Key Design Principles

1. **Separation of Concerns**: Each service has a specific responsibility
2. **Dependency Injection**: Services depend on abstractions, not concrete implementations
3. **Single Responsibility**: Each class has one reason to change
4. **Domain-Driven Design**: Services are organized around business domains
5. **Backward Compatibility**: Legacy imports are maintained through the services package

## Benefits

- **Testability**: Each service can be tested in isolation
- **Maintainability**: Clear separation makes code easier to understand and modify
- **Scalability**: New services can be added without affecting existing ones
- **Reusability**: Services can be reused across different parts of the application
## ËÆ∏ÂèØËØÅ

[MIT](LICENSE)